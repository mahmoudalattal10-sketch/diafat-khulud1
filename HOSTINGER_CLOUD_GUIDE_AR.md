# دليل رفع مشروع Next.js على خطة Hostinger Cloud Startup

خطة **Cloud Startup** هي خطة استضافة سحابية مدارة (Managed Cloud) وتتميز بلوحة تحكم **hPanel** السهلة. الطريقة الصحيحة لرفع مشروع Next.js عليها تختلف عن الـ VPS التقليدي.

إليك الخطوات بالتفصيل لضمان الكفاءة والأمان:

## 1. تجهيز المشروع على جهازك

قبل الرفع، نحتاج للتأكد من أن المشروع جاهز للعمل في بيئة الإنتاج:

1.  تأكد أن ملف `package.json` يحتوي على السكريبت التالي في قسم `scripts`:
    ```json
    "start": "node server.js"
    ```
    *وقد قمت بالتحقق من ملفاتك وهو موجود بالفعل.*

2.  قم ببناء المشروع محلياً لإنشاء مجلد `.next`:
    ```bash
    npm run build
    ```
    *(ملاحظة: في استضافة Cloud، يفضل رفع الملفات المبنية جاهزة لتوفير موارد الخادم، أو بناؤها هناك إذا كانت المساحة تسمح. سنقوم برفع الكود وبنائه هناك لضمان التوافق).*

## 2. الدخول إلى لوحة التحكم (hPanel)

1.  سجل الدخول إلى حسابك في Hostinger.
2.  انتقل إلى **Websites** واختر موقعك (Manage).
3.  في القائمة الجانبية، ابحث عن قسم **Advanced** واختر **Node.js**.

## 3. إعداد بيئة Node.js

1.  **Node.js Version**: اختر إصدار **v18** أو **v20** (الموصى به).
2.  **Application Mode**: اختر **Production**.
3.  **Application Root**: اكتب اسم المجلد الذي ستضع فيه ملفاتك، عادة يكون `domains/yourdomain.com/public_html` (اتركه كما هو إذا كان الافتراضي).
4.  **Application Startup File**: اكتب `server.js`.
    *ملاحظة: ملف `server.js` هو الملف الذي قمت بإنشائه سابقاً لتشغيل Next.js.*
5.  اضغط **Create**.

## 4. رفع الملفات

يمكنك استخدام **File Manager** (مدير الملفات) من لوحة التحكم أو استخدام **Git** (وهو الأفضل).

### الخيار الأفضل: باستخدام Git (إذا كان مشروعك على GitHub/GitLab)
1.  في لوحة التحكم، ابحث عن **Git** (تحت قسم Advanced).
2.  أضف رابط المستودع (Repository URL) والفرع (Branch).
3.  اترك مسار التثبيت فارغاً ليوضع في المجلد الرئيسي، أو حدد مجلداً فرعياً.
4.  اضغط **Create** ثم **Deploy**.

### الخيار البديل: باستخدام File Manager
1.  اضغط مجلدات مشروعك (ماعدا `node_modules` و `.git` و `.next`) في ملف مضغوط `project.zip`.
2.  اذهب إلى **File Manager** في لوحة التحكم.
3.  ادخل إلى مجلد `public_html`.
4.  ارفع ملف `project.zip` وقم بفك الضغط (Extract).
5.  تأكد أن الملفات (مثل `package.json`, `server.js`, مجلد `src`) موجودة مباشرة داخل `public_html` (أو المجلد الذي حددته سابقاً).

## 5. تثبيت المكتبات (Dependencies)

1.  عد إلى صفحة إعداد **Node.js** في لوحة التحكم.
2.  ستجد زر اسمه **NPM Install**. اضغط عليه.
    *سيقوم هذا بتثبيت جميع المكتبات الموجودة في `package.json`.*
    *(إذا واجهت مشاكل، يمكنك الدخول عبر SSH وتنفيذ `npm install` يدوياً).*

## 6. تحسين الأداء (خطوة مهمة جداً)

لضمان عمل الموقع بسرعة وعدم توقف قاعدة البيانات، يجب تشغيل سكريبت التحسين الذي قمنا بإضافته.
عبر **SSH** (كما سيتم شرحه في الخطوة التالية) أو **Run Command**، نفذ الأمر التالي:

```bash
npm run db:optimize
```
*ستظهر لك رسالة `✅ WAL mode enabled`، وهذا يعني أن قاعدة البيانات أصبحت جاهزة لتحمل آلاف الزوار.*

## 7. بناء المشروع (Build)

بما أننا نستخدم Next.js، نحتاج لعمل Build للمشروع على الخادم.
للأسف، واجهة Node.js في hPanel لا تملك زر "Build"، لذا سنستخدم **SSH** أو **Run Command**:

1.  في صفحة Node.js، اضغط على زر **Enter Development Mode** (مؤقتاً) لفتح التيرمنال إذا كان متاحاً، أو الأفضل:
2.  ابحث عن **SSH Access** في لوحة التحكم وقم بتفعيله.
3.  انسخ أمر الدخول (مثل `ssh u12345@1.2.3.4 -p 65002`) وضعه في التيرمنال على جهازك.
4.  بعد الدخول، اذهب لمجلد الموقع:
    ```bash
    cd domains/your-domain.com/public_html
    ```
5.  نفذ أمر البناء:
    ```bash
    npm run build
    ```
    *انتظر حتى ينتهي البناء بنجاح.*

## 7. ضبط متغيرات البيئة (.env)

1.  في صفحة **Node.js**، قد لا تجد مكاناً مخصصاً للمتغيرات في بعض الإصدارات.
2.  الأفضل هو إنشاء ملف `.env` يدوياً داخل `File Manager`:
    *   أنشئ ملفاً جديداً باسم `.env`.
    *   انسخ محتوى `.env.local` وضعه فيه.
    *   **مهم**: عدل `DATABASE_URL` ليشير إلى مسار قاعدة البيانات الصحيح على الخادم (إذا كنت تستخدم SQLite).
        *   مثال: `DATABASE_URL="file:./prod.db"`

## 8. التشغيل النهائي

1.  بعد انتهاء الـ Build وضبط الـ env.
2.  ارجع لصفحة **Node.js**.
3.  تأكد أن **Application Mode** هو **Production**.
4.  اضغط **Restart**.

## 9. الأمان (SSL & Database)

*   **SSL**: توفر Hostinger شهادة SSL مجانية وتلقائية. تأكد من تفعيلها من قسم **SSL** في لوحة التحكم. اضغط **Force HTTPS**.
*   **قاعدة البيانات**: بما أنك تستخدم SQLite، تأكد أن ملف قاعدة البيانات (`dev.db` أو `prod.db`) غير قابل للوصول من المتصفح.
    *   في المجلد `public_html`، أنشئ ملف `.htaccess` وأضف التالي لمنع تحميل ملفات قاعدة البيانات:
        ```apache
        <Files "*.db">
            Require all denied
        </Files>
        <Files "*.sqlite">
            Require all denied
        </Files>
        ```

---
**تمت العملية!** الآن موقعك يجب أن يعمل بسرعة وكفاءة عالية على خطة Cloud Startup.
